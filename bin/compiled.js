'use strict';var g=!0,h=null,j=!1,k,l=this;function m(a,b){var c=a.split("."),d=l;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&void 0!==b?d[e]=b:d=d[e]?d[e]:d[e]={}}function n(a,b){function c(){}c.prototype=b.prototype;a.L=b.prototype;a.prototype=new c};function p(){this.data=h;this.height=this.width=0;this.a=j;this.g=h}k=p.prototype;k.b=function(a){var b=this;this.data.onload=function(){q(b)};this.data.src=a};k.q=function(a){window.console.warn("Nucleus log: "+('Resource "'+a+'" not found.'))};k.f=function(){};function q(a){a.data.complete==g&&a.g!=h&&a.g(a)}k.d=function(){return this.height};k.e=function(){return this.width};k.getData=function(){return this.data};function s(){p.call(this);this.data=new Image}n(s,p);s.prototype.b=function(a){this.data.onload=this.f.bind(this,a);this.data.onerror=this.q.bind(this,a);this.data.src=a};s.prototype.f=function(){var a=this.height;this.width=this.width;this.height=a;q(this);this.a=g};function t(){}t.prototype.create=function(a){var b=h;try{var c={premultipliedAlpha:j,alpha:j},b=a.getContext("webgl",c)||a.getContext("experimental-webgl",c)}catch(d){}b===h&&alert("Missing context");return b};function u(){this.s=new t;this.m=[];this.i=h}u.n=function(){return u.o?u.o:u.o=new u};function v(){return u.n().i}u.prototype.create=function(a){a=this.s.create(a);this.m[this.m.length]=a;this.i==h&&(this.i=a);return a};function w(){p.call(this);this.data=document.createElement("video");this.autoplay=g}n(w,p);w.prototype.b=function(a){this.data.K="auto";this.data.addEventListener("canplaythrough",this.f.bind(this,a),g);this.data.addEventListener("error",this.q.bind(this,a),g);this.data.src=a};w.prototype.f=function(){var a=this.height;this.width=this.width;this.height=a;q(this);this.a=g;this.autoplay&&this.play()};w.prototype.play=function(){this.data.play()};function x(a){this.id=a.createTexture();this.source=h}k=x.prototype;k.bind=function(){v().bindTexture(3553,this.id)};k.create=function(a,b){var c=v(),d=this.source=y();d.width=a;d.height=b;this.bind();d=v();d.texParameteri(3553,10241,9985);d.texParameteri(3553,10240,9729);this.source.e()==this.source.d()&&v().generateMipmap(3553);c.texImage2D(3553,0,6408,a,b,0,6408,5121,h);v().bindTexture(3553,h)};
function y(a){return void 0!=a&&(a=/(?:\.([^.]+))?$/.exec(a)[1],("ogg"==a||"webm"==a?g:j)==g)?new w:new s}k.fill=function(a){var b=v();this.bind();b.texImage2D(3553,0,6408,6408,5121,a)};k.b=function(a){this.source=y(a);var b=this.update.bind(this);this.source.g=b;this.source.b(a)};k.update=function(){this.fill(this.source.getData())};k.d=function(){return this.source.d()};k.e=function(){return this.source.e()};function A(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}A.prototype.BYTES_PER_ELEMENT=8;A.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};A.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{A.BYTES_PER_ELEMENT=8}catch(B){}A.prototype.BYTES_PER_ELEMENT=A.prototype.BYTES_PER_ELEMENT;A.prototype.set=A.prototype.set;A.prototype.toString=A.prototype.toString;m("Float64Array",A)};function C(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}C.prototype.BYTES_PER_ELEMENT=4;C.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};C.prototype.toString=Array.prototype.join;"undefined"==typeof Float32Array&&(C.BYTES_PER_ELEMENT=4,C.prototype.BYTES_PER_ELEMENT=C.prototype.BYTES_PER_ELEMENT,C.prototype.set=C.prototype.set,C.prototype.toString=C.prototype.toString,m("Float32Array",C));function D(a,b){var c=new Float32Array(3);c[0]=a;c[1]=1;c[2]=b;return c}function E(a,b){var c=a[0],d=a[1],e=a[2],c=1/Math.sqrt(c*c+d*d+e*e);b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c}function F(a,b,c){var d=a[0],e=a[1];a=a[2];var f=b[0],r=b[1];b=b[2];c[0]=e*b-a*r;c[1]=a*f-d*b;c[2]=d*r-e*f};function G(a,b,c,d,e,f,r,z,V){a[0]=b;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=d;a[11]=e;a[12]=f;a[13]=r;a[14]=z;a[15]=V;return a}function H(a,b,c){a[b]=c[0];a[b+4]=c[1];a[b+8]=c[2];a[b+12]=c[3]}new Float64Array(3);new Float64Array(3);var I=[new Float64Array(4),new Float64Array(4),new Float64Array(4)];new Float64Array(16);function J(){var a=new Float32Array(16);a[0]=a[5]=a[10]=a[15]=1;this.H=a;this.position=new Float32Array(3);this.rotation=new Float32Array(3);this.scale=D(1,1);this.I=g};function K(a){J.call(this);this.B=new Float32Array(16);this.r=new Float32Array(16);this.J=new Float32Array(9);this.w=D(0,0);var b=new Float32Array(16),c=this.position,d=this.w,e=I[0],f=[0,0,-5];e[0]=f[0]-c[0];e[1]=f[1]-c[1];e[2]=f[2]-c[2];E(e,e);e[3]=0;f=I[1];F(e,d,f);E(f,f);f[3]=0;d=I[2];F(f,e,d);E(d,d);d[3]=0;e[0]=-e[0];e[1]=-e[1];e[2]=-e[2];H(b,0,f);H(b,1,d);H(b,2,e);b[3]=0;b[7]=0;b[11]=0;b[15]=1;var e=-c[0],d=-c[1],c=-c[2],f=b[1]*e+b[5]*d+b[9]*c+b[13],r=b[2]*e+b[6]*d+b[10]*c+b[14],z=b[3]*e+b[7]*
d+b[11]*c+b[15];b[12]=b[0]*e+b[4]*d+b[8]*c+b[12];b[13]=f;b[14]=r;b[15]=z;this.B=b;switch(a){case "2D":a=new Float32Array(16);this.r=G(a,1,1,-2/99,0,-0,-0,-101/99,1);break;default:a=800/600,b=new Float32Array(16),c=Math.sin(22.5),0==c||0==a?a=b:(c=Math.cos(22.5)/c,a=G(b,c/a,c,-101/99,-1,0,0,-200/99,0)),this.r=a}}n(K,J);function L(a){this.parent=h;this.children=[];this.G=0;this.M=a||new J};function M(){L.call(this);this.color=D(1,1);this.direction=D(1,1);this.D=D(0,0);this.F=g}n(M,L);function N(){M.call(this)}n(N,M);function O(){L.call(this);this.C=new N;this.t=[];this.p=0}n(O,L);O.prototype.l=function(a){this.t[this.p]=a;this.p++};function P(a){this.u=a}P.prototype.create=function(){return new x(this.u)};function Q(a){this.h=u.n().create(a);this.v=new P(this.h)}Q.prototype.d=function(){return 0};Q.prototype.e=function(){return 0};function R(){this.A=this.z=g}R.prototype.c=function(a){var b="";if(this.A)var c=S("Material structure"),c=c+"struct Material \n{ \n",c=c+"\tlowp vec3  ambient; \n",c=c+"\tlowp vec4  diffuse; \n",c=c+"\tlowp vec3  specular; \n",c=c+"\tlowp float shininess; \n",c=c+"} \n",b=b+c;this.z&&(b+=this.l());c=S("Main");c+="void main() \n{ \n ";c+=a+"\n";c+="} \n ";return b+=c};
R.prototype.l=function(){var a=S("Light structure"),a=a+"struct Light \n{ \n ",a=a+"\tlowp vec3  position; \n",a=a+"\tlowp vec3  direction; \n",a=a+"\tlowp vec3  colour; \n ";return a+="} \n"};function S(a){var b;b="\n////////////////////////////////// \n";b+="/// "+a+"\n";return b+="////////////////////////////////// \n"};function T(a,b){var c=new XMLHttpRequest;c.open("GET",a,g);c.onreadystatechange=function(){200==this.status&&4==this.readyState&&b(a,c.responseText)};c.send()};function U(a){this.id=v().createShader(a);this.a=j}U.prototype.fill=function(a){var b=v();b.shaderSource(this.id,a);b.compileShader(this.id);this.a=g};function W(){this.id=v().createProgram();this.j=new U(35632);this.k=new U(35633)}W.prototype.c=function(){if(!(this.j.a==j||this.k.a==j)){var a=v();a.attachShader(this.id,this.k.id);a.attachShader(this.id,this.j.id);a.linkProgram(this.id)}};window.application=function(){var a=new Q(document.getElementById("test"));new K("3D");new O;a.v.create().b("data/magpie.png");var b=new W;T("data/shaders/basic/vertex.vert",function(a,b){this.k.fill(b);this.c()}.bind(b));T("data/shaders/basic/fragment.frag",function(a,b){this.j.fill(b);this.c()}.bind(b));(new R).c("v = 5 * 4;");a.h.clearColor(0.2,0.2,0.2,1);a.h.clear(16640)};
