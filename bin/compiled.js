'use strict';var k=void 0,n=!0,q=null,r=!1,ca=this;function da(a,c){var b=a.split("."),d=ca;!(b[0]in d)&&d.execScript&&d.execScript("var "+b[0]);for(var e;b.length&&(e=b.shift());)!b.length&&c!==k?d[e]=c:d=d[e]?d[e]:d[e]={}}function ea(a){a.z=function(){return a.K?a.K:a.K=new a}}function s(a,c){function b(){}b.prototype=c.prototype;a.ta=c.prototype;a.prototype=new b};function fa(){};function ga(){this.B=this.c=q;this.p=0;this.pa=this.X=r;this.$=q;this.Z=0;this.C=q;this.ba=0;this.da=q;this.ca=0;this.T=q}ga.prototype.bind=function(a){var c=this.c,b=t(),d=q,e=q;c.buffer&&c.buffer.bind();c.i.bind();for(var f=0,g=c.t.length;f<g;++f)d=c.t[f],e=a[d.name],e!=k&&(d.buffer!=q&&d.buffer.bind(),b.enableVertexAttribArray(e.id),b.vertexAttribPointer(e.id,d.count,d.type,d.normalize,d.size,d.offset))};
ga.prototype.u=function(){this.c=new ha;var a=0<this.Z,c=0<this.ca,b;b=16;a&&(b+=12);c&&(b+=8);this.X?(this.T=new ArrayBuffer(b),a=this.c,c=this.T,b=this.B,a.buffer=new u,a.buffer.fill(c),a.i.fill(b),a.i.type=5121):(b=this.c,b.i.fill(this.B),b.i.type=5121,this.c.add("aPosition",3,5126,0,12,this.C),this.c.add("aColor",4,5121,0,4,this.C),c&&this.c.add("Texture",2,5126,0,8,this.da),a&&this.c.add("Normal",3,5126,0,12,this.$))};function v(a){this.length=a.length||a;for(var c=0;c<this.length;c++)this[c]=a[c]||0}v.prototype.BYTES_PER_ELEMENT=8;v.prototype.set=function(a,c){c=c||0;for(var b=0;b<a.length&&c+b<this.length;b++)this[c+b]=a[b]};v.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{v.BYTES_PER_ELEMENT=8}catch(ia){}v.prototype.BYTES_PER_ELEMENT=v.prototype.BYTES_PER_ELEMENT;v.prototype.set=v.prototype.set;v.prototype.toString=v.prototype.toString;da("Float64Array",v)};function x(a){this.length=a.length||a;for(var c=0;c<this.length;c++)this[c]=a[c]||0}x.prototype.BYTES_PER_ELEMENT=4;x.prototype.set=function(a,c){c=c||0;for(var b=0;b<a.length&&c+b<this.length;b++)this[c+b]=a[b]};x.prototype.toString=Array.prototype.join;"undefined"==typeof Float32Array&&(x.BYTES_PER_ELEMENT=4,x.prototype.BYTES_PER_ELEMENT=x.prototype.BYTES_PER_ELEMENT,x.prototype.set=x.prototype.set,x.prototype.toString=x.prototype.toString,da("Float32Array",x));function ja(a,c){var b=new Float32Array(3);b[0]=a;b[1]=1;b[2]=c;return b}function ka(a,c){var b=a[0],d=a[1],e=a[2],b=1/Math.sqrt(b*b+d*d+e*e);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b}function la(a,c,b){var d=a[0],e=a[1];a=a[2];var f=c[0],g=c[1];c=c[2];b[0]=e*c-a*g;b[1]=a*f-d*c;b[2]=d*g-e*f};function y(){return new Float32Array(16)}function ma(a,c,b,d,e,f,g,p,m,l,j,h,w,A,B,C,D){a[0]=c;a[1]=b;a[2]=d;a[3]=e;a[4]=f;a[5]=g;a[6]=p;a[7]=m;a[8]=l;a[9]=j;a[10]=h;a[11]=w;a[12]=A;a[13]=B;a[14]=C;a[15]=D;return a}function na(a,c,b){a[c]=b[0];a[c+4]=b[1];a[c+8]=b[2];a[c+12]=b[3]}function oa(a,c,b,d){var e=a[1]*c+a[5]*b+a[9]*d+a[13],f=a[2]*c+a[6]*b+a[10]*d+a[14],g=a[3]*c+a[7]*b+a[11]*d+a[15];a[12]=a[0]*c+a[4]*b+a[8]*d+a[12];a[13]=e;a[14]=f;a[15]=g}
function pa(a,c,b,d){ma(a,a[0]*c,a[1]*c,a[2]*c,a[3]*c,a[4]*b,a[5]*b,a[6]*b,a[7]*b,a[8]*d,a[9]*d,a[10]*d,a[11]*d,a[12],a[13],a[14],a[15])}function qa(a,c){var b=a[4],d=a[5],e=a[6],f=a[7],g=a[8],p=a[9],m=a[10],l=a[11],j=Math.cos(c),h=Math.sin(c);a[4]=b*j+g*h;a[5]=d*j+p*h;a[6]=e*j+m*h;a[7]=f*j+l*h;a[8]=b*-h+g*j;a[9]=d*-h+p*j;a[10]=e*-h+m*j;a[11]=f*-h+l*j}
function ra(a,c){var b=a[0],d=a[1],e=a[2],f=a[3],g=a[8],p=a[9],m=a[10],l=a[11],j=Math.cos(c),h=Math.sin(c);a[0]=b*j+g*-h;a[1]=d*j+p*-h;a[2]=e*j+m*-h;a[3]=f*j+l*-h;a[8]=b*h+g*j;a[9]=d*h+p*j;a[10]=e*h+m*j;a[11]=f*h+l*j}function sa(a,c){var b=a[0],d=a[1],e=a[2],f=a[3],g=a[4],p=a[5],m=a[6],l=a[7],j=Math.cos(c),h=Math.sin(c);a[0]=b*j+g*h;a[1]=d*j+p*h;a[2]=e*j+m*h;a[3]=f*j+l*h;a[4]=b*-h+g*j;a[5]=d*-h+p*j;a[6]=e*-h+m*j;a[7]=f*-h+l*j}new Float64Array(3);new Float64Array(3);
var ta=[new Float64Array(4),new Float64Array(4),new Float64Array(4)];new Float64Array(16);function z(){var a=y();a[0]=a[5]=a[10]=a[15]=1;this.b=a;this.position=new Float32Array(3);this.rotation=new Float32Array(3);this.scale=ja(1,1);this.g=n}
z.prototype.A=function(){if(this.g){var a=this.b,c=this.position[0],b=this.position[1],d=this.position[2];a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;a[12]=c;a[13]=b;a[14]=d;a[15]=1;pa(this.b,this.scale[0],this.scale[1],this.scale[2]);qa(this.b,this.rotation[0]);ra(this.b,this.rotation[1]);sa(this.b,this.rotation[2]);this.g=r}return this.b};function E(a){this.parent=q;this.children=[];this.v=0;this.P=a||new z}E.prototype.add=function(a){this.children[this.v]=a;this.v++};function F(){var a=new Float32Array(4);a[0]=1;a[1]=1;a[2]=1;a[3]=1;this.value=a};function ua(){this.fa=new F;this.ia=va;this.la=new F;this.W=wa;this.a=xa();this.ra=5;this.sa=new F;this.O=q;this.visible=n}var va=3,wa=4;ua.prototype.N=function(a){this.a=a};function ya(a,c){E.call(this);this.d=a;this.L=c}s(ya,E);function za(a){window.console.error("Nucleus log: "+a)};function Aa(a){this.id=t().createShader(a);this.r=r}Aa.prototype.fill=function(a){var c=t();c.shaderSource(this.id,a);c.compileShader(this.id);this.r=n};function Ba(a){if(5124!=a){if(5126==a)return"float";if(35664==a)return"vec2";if(35665==a)return"vec3";if(35666==a)return"vec4";if(3==a)return"sampler2D";if(1==a)return"mat3";if(0==a)return"mat4";if(35670==a)return"bool"}return"int"};function Ca(){this.id=-1;this.count=1;this.data=0;this.elements=new G;this.Y=5126;this.normalize=r;this.precision="lowp"};function G(){this.elements=[];this.H=0}G.prototype.add=function(a,c,b,d,e){var f=new Ca;f.type=b;f.count=c;f.precision=d||"lowp";f.Y=e||5126;this.elements[a]=f;this.H++};function Da(){this.f=new G;this.m=new Aa(35632);this.id=t().createProgram();this.e=new G;this.s=new Aa(35633)}Da.prototype.bind=function(){t().useProgram(this.id)};
Da.prototype.u=function(){if(!(this.m.r==r||this.s.r==r)){var a=t();a.attachShader(this.id,this.s.id);a.attachShader(this.id,this.m.id);a.linkProgram(this.id);t().deleteShader(this.s.id);t().deleteShader(this.m.id);if(a.getProgramParameter(this.id,35714)){var a=t(),c=this.f.elements,b;for(b in c)c[b].id=a.getAttribLocation(this.id,b);b=t();var a=this.e.elements,d;for(d in a)a[d].id=b.getUniformLocation(this.id,d),a[d].id==q&&(a[d].id=-1)}else za("Error found during shader compilation.")}};function Ea(a){this.I="";this.ma=[];this.a=a||new Da;this.l=[];this.wa=this.R=this.Q=n;this.S=""}function Fa(a){var c=H("Main"),c=c+"void main() \n{ \n ",c=c+(a+"\n");return c+="} \n "}function H(a){var c;c="\n////////////////////////////////// \n";c+="/// "+(a.charAt(0).toUpperCase()+a.slice(1))+".\n";return c+="////////////////////////////////// \n"}function Ga(a,c,b){var d=Ba(c.type),e="",e=b==k||b==n?a:"v"+a.substring(1);return c.precision+" "+d+" "+e+";"}
function Ha(a,c){var b=c==r?"attribute":"varying",d=H(b+"s"),e=a.a.f.elements,f;for(f in e)d+=b+" "+Ga(f,e[f],!c)+"\n";return d}
Ea.prototype.create=function(){this.a==q&&za("ProgramBuilder can't generate the given program.");var a="",c="";if(this.R){var b=new G;b.add("ambient",1,35665);b.add("diffuse",1,35666);b.add("specular",1,35665);b.add("shininess",1,5126);this.l.Material=b}this.Q&&(b=new G,b.add("position",1,35665),b.add("direction",1,35665),b.add("color",1,35665),this.l.Light=b);this.a==q&&za("Program is null, ProgramBuilder can't add default uniforms.");this.a.e.add("uMvp",1,0,"mediump");this.a.e.add("uModel",1,0,
"mediump");this.a.e.add("uAmbientLight",1,35665,k);this.R&&this.a.e.add("uMaterial",1,12,k);this.Q&&this.a.e.add("uLight",14,12,k);this.a.f.add("aPosition",3,35665,k);this.a.f.add("aColor",4,35666,k);this.a.f.add("aTexCoord",2,35664,k);this.a.f.add("aNormal",3,35665,k);var d,b="";for(d in this.l){var b=b+H(d+" structure"),b=b+("struct "+d+"\n"),b=b+"{\n",e;for(e in this.l[d].elements)b+="\t"+Ga(e,this.l[d].elements[e])+"\n";b+="};\n"}d=b;var a=a+d,c=c+d,f;d=H("Uniforms");e=q;var b="",g=this.a.e.elements;
for(f in g)b=1<g[f].count?"["+g[f].count+"]":"",e=12==g[f].type?f.substr(1):g[f].precision+" "+Ba(g[f].type),d+="uniform "+e+" "+f+b+"; \n";f=d;c+=f;a=a+f+Ha(this,r);a+=Ha(this,n);c+=Ha(this,n);c+=Fa(this.I);a+=Fa(this.S);f=this.a;f.m.fill(c);f.s.fill(a);f.u();return this.a};function Ia(){this.q=[]}ea(Ia);Ia.prototype.M=function(a,c){this.q[a]=c};function xa(){var a=Ia.z();if(a.q["default"]==k){var c;c="vColor\t\t  = aColor; \ngl_Position   = (uMvp * uModel) * vec4( aPosition, 1.0);";var b=new Ea;b.S=c;b.I="gl_FragColor  = vColor;";a.q["default"]=b.create()}return a.q["default"]};function I(){this.data=q;this.height=this.width=0;this.r=r;this.ka=q}I.prototype.n=function(){return this.height};I.prototype.o=function(){return this.width};function Ja(){I.call(this);this.data=new Image}s(Ja,I);function Ka(){}Ka.prototype.create=function(a){var c=q;try{var b={premultipliedAlpha:r,alpha:r},c=a.getContext("webgl",b)||a.getContext("experimental-webgl",b)}catch(d){}c===q&&alert("Missing context");return c};function J(){this.V=new Ka;this.G=[];this.w=q}ea(J);function t(){return J.z().w}J.prototype.create=function(a){a=this.V.create(a);this.M(a);this.w==q&&(this.w=a);return a};J.prototype.M=function(a){this.G[this.G.length]=a};function K(a){a=a||t();this.id=a.createTexture();this.source=q}K.prototype.bind=function(){t().bindTexture(3553,this.id)};K.prototype.create=function(a,c){var b=t(),d;d=new Ja;d=this.source=d;d.width=a;d.height=c;this.bind();d=t();d.texParameteri(3553,10241,9985);d.texParameteri(3553,10240,9729);this.source.o()==this.source.n()&&t().generateMipmap(3553);b.texImage2D(3553,0,6408,a,c,0,6408,5121,q);t().bindTexture(3553,q)};
K.prototype.fill=function(a){var c=t();this.bind();c.texImage2D(3553,0,6408,6408,5121,a)};K.prototype.n=function(){return this.source.n()};K.prototype.o=function(){return this.source.o()};function La(a){this.aa=a}La.prototype.create=function(){return new K(this.aa)};function L(){this.id=q;this.H=0;this.h=t()}L.prototype.bind=function(){};L.prototype.fill=function(){};function M(){L.call(this);this.id=this.h.createBuffer();this.type=5121}s(M,L);M.prototype.bind=function(){this.h.bindBuffer(34963,this.id)};M.prototype.fill=function(a){this.bind();this.h.bufferData(34963,a,35044)};function Ma(){this.buffer=q;this.name="";this.normalize=r;this.size=this.offset=0;this.type=5126;this.va=r};function u(){L.call(this);this.id=this.h.createBuffer()}s(u,L);u.prototype.bind=function(){this.h.bindBuffer(34962,this.id)};u.prototype.fill=function(a){this.bind();this.h.bufferData(34962,a,35044)};function ha(){this.xa=new u;this.i=new M;this.t=[];this.F=0}s(ha,fa);ha.prototype.add=function(a,c,b,d,e,f){var g=new Ma;d!=k&&f!=k&&(g.buffer=new u,g.buffer.fill(f));g.count=c;g.name=a;g.offset=d||g.offset;g.type=b||g.type;g.size=e||g.size;this.t[this.F]=g;this.F++};function Na(){this.O=this.a=this.J=this.d=q}Na.prototype.clear=function(){this.d=this.O=this.a=q};
Na.prototype.N=function(a){if(a!=this.a){this.a=a;this.a.bind();a=this.a.e.elements;var c=t(),b;for(b in a)-1!=a[b].id&&(0==a[b].type?c.uniformMatrix4fv(a[b].id,a[b].normalize,a[b].data):1==a[b].type?c.uniformMatrix3fv(a[b].id,a[b].normalize,a[b].data):35665==a[b].type?c.uniform3fv(a[b].id,a[b].data):8==a[b].type?c.uniform1iv(a[b].id,a[b].data):5126==a[b].type?c.uniform1f(a[b].id,a[b].data):(3==a[b].type||5124==a[b].type)&&c.uniform1i(a[b].id,a[b].data))}};function Oa(a){z.call(this);this.U=y();this.D=y();this.qa=new Float32Array(9);this.ea=ja(0,0);this.viewport={x:0,y:0,width:800,height:600};Pa(this);switch(a){case "2D":a=y();this.D=ma(a,1,0,0,0,0,1,0,0,0,0,-2/99,0,-0,-0,-101/99,1);break;default:a=this.viewport.width/this.viewport.height;var c=y(),b=Math.sin(22.5);0==b||0==a?a=c:(b=Math.cos(22.5)/b,a=ma(c,b/a,0,0,0,0,b,0,0,0,0,-101/99,-1,0,0,-200/99,0));this.D=a}}s(Oa,z);
function Pa(a){var c=y(),b=a.position,d=a.ea,e=ta[0],f=[0,0,-5];e[0]=f[0]-b[0];e[1]=f[1]-b[1];e[2]=f[2]-b[2];ka(e,e);e[3]=0;f=ta[1];la(e,d,f);ka(f,f);f[3]=0;d=ta[2];la(f,e,d);ka(d,d);d[3]=0;e[0]=-e[0];e[1]=-e[1];e[2]=-e[2];na(c,0,f);na(c,1,d);na(c,2,e);c[3]=0;c[7]=0;c[11]=0;c[15]=1;oa(c,-b[0],-b[1],-b[2]);a.U=c}
Oa.prototype.A=function(){if(this.g){var a=this.U,c=y();c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];this.b=c;oa(this.b,this.position[0],this.position[1],this.position[2]);pa(this.b,this.scale[0],this.scale[1],this.scale[2]);qa(this.b,this.rotation[0]);ra(this.b,this.rotation[1]);sa(this.b,this.rotation[2]);var b=this.D,d=this.b,a=this.b,c=b[0],e=b[1],f=b[2],g=b[3],p=b[4],
m=b[5],l=b[6],j=b[7],h=b[8],w=b[9],A=b[10],B=b[11],C=b[12],D=b[13],N=b[14],b=b[15],O=d[0],P=d[1],Q=d[2],R=d[3],S=d[4],T=d[5],U=d[6],V=d[7],W=d[8],X=d[9],Y=d[10],Z=d[11],$=d[12],aa=d[13],ba=d[14],d=d[15];a[0]=c*O+p*P+h*Q+C*R;a[1]=e*O+m*P+w*Q+D*R;a[2]=f*O+l*P+A*Q+N*R;a[3]=g*O+j*P+B*Q+b*R;a[4]=c*S+p*T+h*U+C*V;a[5]=e*S+m*T+w*U+D*V;a[6]=f*S+l*T+A*U+N*V;a[7]=g*S+j*T+B*U+b*V;a[8]=c*W+p*X+h*Y+C*Z;a[9]=e*W+m*X+w*Y+D*Z;a[10]=f*W+l*X+A*Y+N*Z;a[11]=g*W+j*X+B*Y+b*Z;a[12]=c*$+p*aa+h*ba+C*d;a[13]=e*$+m*aa+w*ba+
D*d;a[14]=f*$+l*aa+A*ba+N*d;a[15]=g*$+j*aa+B*ba+b*d;this.g=r}return this.b};function Qa(){E.call(this);this.color=new F;this.direction=ja(1,1);this.ha=new F;this.ja=n}s(Qa,E);function Ra(){Qa.call(this)}s(Ra,Qa);function Sa(){E.call(this);this.ga=new Ra;this.na=[];this.oa=0}s(Sa,E);function Ta(a){this.k=J.z().create(a);this.ua=new La(this.k);this.j=new Na}function Ua(a,c,b,d){var e=0;for(b=b.v;e<b;++e){var f=a,g=c,p=d[e],m=f,l=p;if(!(l.L==q||l.d==q)){var j=l.L,h=j.a,w=h.e.elements;w.uMvp.data=g.A();w.uModel.data=l.P.A();m.j.N(h);h=m.j;l=l.d;l!=h.d&&(h.d=l,h.J=h.d.c,h.d.bind(h.a.f.elements));m.k.drawElements(j.W,m.j.d.p,m.j.J.i.type,0)}Ua(f,g,p,p.children)}}Ta.prototype.n=function(){return 0};Ta.prototype.o=function(){return 0};window.application=function(){var a=new Ta(document.getElementById("test")),c=new Oa("3D"),b=c.position;b[0]=0;b[1]=0;b[2]=2;c.g=n;Pa(c);b=c.position;b[0]=0;b[1]=0;b[2]=0;c.g=n;var b=new Sa,d=new ga,e=[0.5,-0.5,0,0.5,0.5,0,-0.5,0.5,0,-0.5,-0.5,0];d.C=new Float32Array(e);d.ba=e.length;e=[0,1,2,2,3,0];d.p=e.length;d.B=255>d.p?new Uint8Array(e):65535>d.p?new Uint16Array(e):new Uint32Array(e);d.u();var d=new ya(d,new ua),e=d.P,f=e.scale;f[0]=1;f[1]=1;f[2]=1;e.g=n;b.add(d);xa();a.k.clearColor(0.2,0.2,
0.2,1);a.k.clear(16640);a.k.viewport(c.viewport.x,c.viewport.y,c.viewport.width,c.viewport.height);Ua(a,c,b,b.children);a.j.clear()};
