'use strict';var k=void 0,n=!0,q=null,r=!1,ea=this;function fa(a,c){var b=a.split("."),d=ea;!(b[0]in d)&&d.execScript&&d.execScript("var "+b[0]);for(var e;b.length&&(e=b.shift());)!b.length&&c!==k?d[e]=c:d=d[e]?d[e]:d[e]={}}function ga(a){a.A=function(){return a.M?a.M:a.M=new a}}function s(a,c){function b(){}b.prototype=c.prototype;a.wa=c.prototype;a.prototype=new b};function ha(){};function ia(){this.C=this.c=q;this.r=0;this.sa=this.Z=r;this.ba=q;this.aa=0;this.D=q;this.da=0;this.fa=q;this.ea=0;this.V=q}ia.prototype.bind=function(a){var c=this.c,b=t(),d=q,e=q;c.buffer&&c.buffer.bind();c.j.bind();for(var f=0,g=c.f.length;f<g;++f)d=c.f[f],e=a[d.name],e!=k&&(d.buffer!=q&&d.buffer.bind(),b.enableVertexAttribArray(e.id),b.vertexAttribPointer(e.id,d.count,d.type,d.normalize,d.size,d.offset))};
ia.prototype.v=function(){this.c=new ja;var a=0<this.aa,c=0<this.ea,b;b=16;a&&(b+=12);c&&(b+=8);this.Z?(this.V=new ArrayBuffer(b),a=this.c,c=this.V,b=this.C,a.buffer=new u,a.buffer.fill(c),a.j.fill(b),a.j.type=5121):(b=this.c,b.j.fill(this.C),b.j.type=5121,this.c.add("aPosition",3,5126,0,12,this.D),this.c.add("aColor",4,5121,0,4,this.D),c&&this.c.add("Texture",2,5126,0,8,this.fa),a&&this.c.add("Normal",3,5126,0,12,this.ba))};function w(a){this.length=a.length||a;for(var c=0;c<this.length;c++)this[c]=a[c]||0}w.prototype.BYTES_PER_ELEMENT=8;w.prototype.set=function(a,c){c=c||0;for(var b=0;b<a.length&&c+b<this.length;b++)this[c+b]=a[b]};w.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{w.BYTES_PER_ELEMENT=8}catch(ka){}w.prototype.BYTES_PER_ELEMENT=w.prototype.BYTES_PER_ELEMENT;w.prototype.set=w.prototype.set;w.prototype.toString=w.prototype.toString;fa("Float64Array",w)};function x(a){this.length=a.length||a;for(var c=0;c<this.length;c++)this[c]=a[c]||0}x.prototype.BYTES_PER_ELEMENT=4;x.prototype.set=function(a,c){c=c||0;for(var b=0;b<a.length&&c+b<this.length;b++)this[c+b]=a[b]};x.prototype.toString=Array.prototype.join;"undefined"==typeof Float32Array&&(x.BYTES_PER_ELEMENT=4,x.prototype.BYTES_PER_ELEMENT=x.prototype.BYTES_PER_ELEMENT,x.prototype.set=x.prototype.set,x.prototype.toString=x.prototype.toString,fa("Float32Array",x));function la(a,c){var b=new Float32Array(3);b[0]=a;b[1]=1;b[2]=c;return b}function ma(a,c){var b=a[0],d=a[1],e=a[2],b=1/Math.sqrt(b*b+d*d+e*e);c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b}function na(a,c,b){var d=a[0],e=a[1];a=a[2];var f=c[0],g=c[1];c=c[2];b[0]=e*c-a*g;b[1]=a*f-d*c;b[2]=d*g-e*f};function y(){return new Float32Array(16)}function oa(a,c,b,d,e,f,g,p,m,l,h,j,v,A,B,C,D){a[0]=c;a[1]=b;a[2]=d;a[3]=e;a[4]=f;a[5]=g;a[6]=p;a[7]=m;a[8]=l;a[9]=h;a[10]=j;a[11]=v;a[12]=A;a[13]=B;a[14]=C;a[15]=D;return a}function pa(a,c,b){a[c]=b[0];a[c+4]=b[1];a[c+8]=b[2];a[c+12]=b[3]}function qa(a,c,b,d){var e=a[1]*c+a[5]*b+a[9]*d+a[13],f=a[2]*c+a[6]*b+a[10]*d+a[14],g=a[3]*c+a[7]*b+a[11]*d+a[15];a[12]=a[0]*c+a[4]*b+a[8]*d+a[12];a[13]=e;a[14]=f;a[15]=g}
function ra(a,c,b,d){oa(a,a[0]*c,a[1]*c,a[2]*c,a[3]*c,a[4]*b,a[5]*b,a[6]*b,a[7]*b,a[8]*d,a[9]*d,a[10]*d,a[11]*d,a[12],a[13],a[14],a[15])}function sa(a,c){var b=a[4],d=a[5],e=a[6],f=a[7],g=a[8],p=a[9],m=a[10],l=a[11],h=Math.cos(c),j=Math.sin(c);a[4]=b*h+g*j;a[5]=d*h+p*j;a[6]=e*h+m*j;a[7]=f*h+l*j;a[8]=b*-j+g*h;a[9]=d*-j+p*h;a[10]=e*-j+m*h;a[11]=f*-j+l*h}
function ta(a,c){var b=a[0],d=a[1],e=a[2],f=a[3],g=a[8],p=a[9],m=a[10],l=a[11],h=Math.cos(c),j=Math.sin(c);a[0]=b*h+g*-j;a[1]=d*h+p*-j;a[2]=e*h+m*-j;a[3]=f*h+l*-j;a[8]=b*j+g*h;a[9]=d*j+p*h;a[10]=e*j+m*h;a[11]=f*j+l*h}function ua(a,c){var b=a[0],d=a[1],e=a[2],f=a[3],g=a[4],p=a[5],m=a[6],l=a[7],h=Math.cos(c),j=Math.sin(c);a[0]=b*h+g*j;a[1]=d*h+p*j;a[2]=e*h+m*j;a[3]=f*h+l*j;a[4]=b*-j+g*h;a[5]=d*-j+p*h;a[6]=e*-j+m*h;a[7]=f*-j+l*h}new Float64Array(3);new Float64Array(3);
var va=[new Float64Array(4),new Float64Array(4),new Float64Array(4)];new Float64Array(16);function z(){var a=y();a[0]=a[5]=a[10]=a[15]=1;this.b=a;this.position=new Float32Array(3);this.rotation=new Float32Array(3);this.scale=la(1,1);this.g=n}
z.prototype.B=function(){if(this.g){var a=this.b,c=this.position[0],b=this.position[1],d=this.position[2];a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;a[12]=c;a[13]=b;a[14]=d;a[15]=1;ra(this.b,this.scale[0],this.scale[1],this.scale[2]);sa(this.b,this.rotation[0]);ta(this.b,this.rotation[1]);ua(this.b,this.rotation[2]);this.g=r}return this.b};function E(a){this.parent=q;this.children=[];this.w=0;this.Q=a||new z}E.prototype.add=function(a){this.children[this.w]=a;this.w++};function F(){var a=new Float32Array(4);a[0]=1;a[1]=1;a[2]=1;a[3]=1;this.value=a};function wa(){this.ha=new F;this.ka=xa;this.na=new F;this.Y=ya;this.a=za();this.ua=5;this.va=new F;this.P=q;this.visible=n}var xa=3,ya=4;function Aa(a,c){E.call(this);this.d=a;this.N=c}s(Aa,E);function Ba(){this.data=0;this.id=-1;this.type=G};function Ca(a){window.console.error("Nucleus log: "+a)};function Da(a){this.id=t().createShader(a);this.t=r}var G=5126;Da.prototype.fill=function(a){var c=t();c.shaderSource(this.id,a);c.compileShader(this.id);this.t=n};function Ea(a){if(5124!=a){if(a==G)return"float";if(35664==a)return"vec2";if(35665==a)return"vec3";if(35666==a)return"vec4";if(3==a)return"sampler2D";if(1==a)return"mat3";if(0==a)return"mat4";if(35670==a)return"bool"}return"int"};function Fa(){this.id=-1;this.count=1;this.data=0;this.elements=new H;this.$=G;this.normalize=r;this.precision="lowp"};function H(){this.elements=[];this.J=0}H.prototype.add=function(a,c,b,d,e){var f=new Fa;f.type=b;f.count=c;f.precision=d||"lowp";f.$=e||G;this.elements[a]=f;this.J++};function Ga(){this.id=-1};function I(){this.f=[];this.k=[];this.o=new Da(35632);this.id=t().createProgram();this.ra=[];this.u=new Da(35633)}I.prototype.h=function(a){this.f[a]=new Ga};I.prototype.e=function(a){var c=new Ba;c.type=a;return c};I.prototype.bind=function(){t().useProgram(this.id)};
I.prototype.v=function(){if(!(this.o.t==r||this.u.t==r)){var a=t();a.attachShader(this.id,this.u.id);a.attachShader(this.id,this.o.id);a.linkProgram(this.id);t().deleteShader(this.u.id);t().deleteShader(this.o.id);if(a.getProgramParameter(this.id,35714)){var a=t(),c=this.f,b;for(b in c)c[b].id=a.getAttribLocation(this.id,b);b=t();var a=this.k,d;for(d in a)a[d].id=b.getUniformLocation(this.id,d),a[d].id==q&&(a[d].id=-1)}else Ca("Error found during shader compilation.")}};function J(a){this.H=new H;this.K="";this.oa=[];this.a=a||new I;this.n=[];this.R=new H;this.za=this.T=this.S=n;this.U=""}J.prototype.h=function(a,c,b,d){this.H.add(a,c,b,d);this.a.h(a,b)};J.prototype.e=function(a,c,b,d){this.R.add(a,c,b,d);c=this.a;c.k[a]=c.e(b)};function Ha(a){var c=K("Main"),c=c+"void main() \n{ \n ",c=c+(a+"\n");return c+="} \n "}
function K(a){var c;c="\n////////////////////////////////// \n";c+="/// "+(a.charAt(0).toUpperCase()+a.slice(1))+".\n";return c+="////////////////////////////////// \n"}function Ia(a,c,b){var d=Ea(c.type),e="",e=b==k||b==n?a:"v"+a.substring(1);return c.precision+" "+d+" "+e+";"}function Ja(a,c){var b=c==r?"attribute":"varying",d=K(b+"s"),e=a.H.elements,f;for(f in e)d+=b+" "+Ia(f,e[f],!c)+"\n";return d}
J.prototype.create=function(){this.a==q&&Ca("ProgramBuilder can't generate the given program.");var a="",c="";if(this.T){var b=new H;b.add("ambient",1,35665);b.add("diffuse",1,35666);b.add("specular",1,35665);b.add("shininess",1,G);this.n.Material=b}this.S&&(b=new H,b.add("position",1,35665),b.add("direction",1,35665),b.add("color",1,35665),this.n.Light=b);this.a==q&&Ca("Program is null, ProgramBuilder can't add default uniforms.");this.e("uMvp",1,0,"mediump");this.e("uModel",1,0,"mediump");this.e("uAmbientLight",
1,35665);this.T&&this.e("uMaterial",1,12);this.S&&this.e("uLight",1,12);this.h("aPosition",3,35665);this.h("aColor",4,35666);this.h("aTexCoord",2,35664);this.h("aNormal",3,35665);var d,b="";for(d in this.n){var b=b+K(d+" structure"),b=b+("struct "+d+"\n"),b=b+"{\n",e;for(e in this.n[d].elements)b+="\t"+Ia(e,this.n[d].elements[e])+"\n";b+="};\n"}d=b;var a=a+d,c=c+d,f;d=K("Uniforms");e=q;var b="",g=this.R.elements;for(f in g)b=1<g[f].count?"["+g[f].count+"]":"",e=12==g[f].type?f.substr(1):g[f].precision+
" "+Ea(g[f].type),d+="uniform "+e+" "+f+b+"; \n";f=d;c+=f;a=a+f+Ja(this,r);a+=Ja(this,n);c+=Ja(this,n);c+=Ha(this.K);a+=Ha(this.U);f=this.a;f.o.fill(c);f.u.fill(a);f.v();return this.a};function Ka(){this.s=[]}ga(Ka);Ka.prototype.O=function(a,c){this.s[a]=c};function za(){var a=Ka.A();if(a.s["default"]==k){var c;c="vColor\t\t  = aColor; \ngl_Position   = (uMvp * uModel) * vec4( aPosition, 1.0);";var b=new J;b.U=c;b.K="gl_FragColor  = vColor;";a.s["default"]=b.create()}return a.s["default"]};function L(){this.data=q;this.height=this.width=0;this.t=r;this.ma=q}L.prototype.p=function(){return this.height};L.prototype.q=function(){return this.width};function La(){L.call(this);this.data=new Image}s(La,L);function Ma(){}Ma.prototype.create=function(a){var c=q;try{var b={premultipliedAlpha:r,alpha:r},c=a.getContext("webgl",b)||a.getContext("experimental-webgl",b)}catch(d){}c===q&&alert("Missing context");return c};function M(){this.X=new Ma;this.I=[];this.z=q}ga(M);function t(){return M.A().z}M.prototype.create=function(a){a=this.X.create(a);this.O(a);this.z==q&&(this.z=a);return a};M.prototype.O=function(a){this.I[this.I.length]=a};function N(a){a=a||t();this.id=a.createTexture();this.source=q}N.prototype.bind=function(){t().bindTexture(3553,this.id)};N.prototype.create=function(a,c){var b=t(),d;d=new La;d=this.source=d;d.width=a;d.height=c;this.bind();d=t();d.texParameteri(3553,10241,9985);d.texParameteri(3553,10240,9729);this.source.q()==this.source.p()&&t().generateMipmap(3553);b.texImage2D(3553,0,6408,a,c,0,6408,5121,q);t().bindTexture(3553,q)};
N.prototype.fill=function(a){var c=t();this.bind();c.texImage2D(3553,0,6408,6408,5121,a)};N.prototype.p=function(){return this.source.p()};N.prototype.q=function(){return this.source.q()};function Na(a){this.ca=a}Na.prototype.create=function(){return new N(this.ca)};function Oa(a){z.call(this);this.W=y();this.F=y();this.ta=new Float32Array(9);this.ga=la(0,0);this.viewport={x:0,y:0,width:800,height:600};Pa(this);switch(a){case "2D":a=y();this.F=oa(a,1,0,0,0,0,1,0,0,0,0,-2/99,0,-0,-0,-101/99,1);break;default:a=this.viewport.width/this.viewport.height;var c=y(),b=Math.sin(22.5);0==b||0==a?a=c:(b=Math.cos(22.5)/b,a=oa(c,b/a,0,0,0,0,b,0,0,0,0,-101/99,-1,0,0,-200/99,0));this.F=a}}s(Oa,z);
function Pa(a){var c=y(),b=a.position,d=a.ga,e=va[0],f=[0,0,-5];e[0]=f[0]-b[0];e[1]=f[1]-b[1];e[2]=f[2]-b[2];ma(e,e);e[3]=0;f=va[1];na(e,d,f);ma(f,f);f[3]=0;d=va[2];na(f,e,d);ma(d,d);d[3]=0;e[0]=-e[0];e[1]=-e[1];e[2]=-e[2];pa(c,0,f);pa(c,1,d);pa(c,2,e);c[3]=0;c[7]=0;c[11]=0;c[15]=1;qa(c,-b[0],-b[1],-b[2]);a.W=c}
Oa.prototype.B=function(){if(this.g){var a=this.W,c=y();c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];this.b=c;qa(this.b,this.position[0],this.position[1],this.position[2]);ra(this.b,this.scale[0],this.scale[1],this.scale[2]);sa(this.b,this.rotation[0]);ta(this.b,this.rotation[1]);ua(this.b,this.rotation[2]);var b=this.F,d=this.b,a=this.b,c=b[0],e=b[1],f=b[2],g=b[3],p=b[4],
m=b[5],l=b[6],h=b[7],j=b[8],v=b[9],A=b[10],B=b[11],C=b[12],D=b[13],P=b[14],b=b[15],Q=d[0],R=d[1],S=d[2],T=d[3],U=d[4],V=d[5],W=d[6],X=d[7],Y=d[8],Z=d[9],$=d[10],aa=d[11],ba=d[12],ca=d[13],da=d[14],d=d[15];a[0]=c*Q+p*R+j*S+C*T;a[1]=e*Q+m*R+v*S+D*T;a[2]=f*Q+l*R+A*S+P*T;a[3]=g*Q+h*R+B*S+b*T;a[4]=c*U+p*V+j*W+C*X;a[5]=e*U+m*V+v*W+D*X;a[6]=f*U+l*V+A*W+P*X;a[7]=g*U+h*V+B*W+b*X;a[8]=c*Y+p*Z+j*$+C*aa;a[9]=e*Y+m*Z+v*$+D*aa;a[10]=f*Y+l*Z+A*$+P*aa;a[11]=g*Y+h*Z+B*$+b*aa;a[12]=c*ba+p*ca+j*da+C*d;a[13]=e*ba+m*
ca+v*da+D*d;a[14]=f*ba+l*ca+A*da+P*d;a[15]=g*ba+h*ca+B*da+b*d;this.g=r}return this.b};function Qa(){E.call(this);this.color=new F;this.direction=la(1,1);this.ja=new F;this.la=n}s(Qa,E);function Ra(){Qa.call(this)}s(Ra,Qa);function Sa(){E.call(this);this.ia=new Ra;this.pa=[];this.qa=0}s(Sa,E);function O(){this.id=q;this.J=0;this.i=t()}O.prototype.bind=function(){};O.prototype.fill=function(){};function Ta(){O.call(this);this.id=this.i.createBuffer();this.type=5121}s(Ta,O);Ta.prototype.bind=function(){this.i.bindBuffer(34963,this.id)};Ta.prototype.fill=function(a){this.bind();this.i.bufferData(34963,a,35044)};function Ua(){this.buffer=q;this.name="";this.normalize=r;this.size=this.offset=0;this.type=5126;this.ya=r};function u(){O.call(this);this.id=this.i.createBuffer()}s(u,O);u.prototype.bind=function(){this.i.bindBuffer(34962,this.id)};u.prototype.fill=function(a){this.bind();this.i.bufferData(34962,a,35044)};function ja(){this.Aa=new u;this.j=new Ta;this.f=[];this.G=0}s(ja,ha);ja.prototype.add=function(a,c,b,d,e,f){var g=new Ua;d!=k&&f!=k&&(g.buffer=new u,g.buffer.fill(f));g.count=c;g.name=a;g.offset=d||g.offset;g.type=b||g.type;g.size=e||g.size;this.f[this.G]=g;this.G++};function Va(){this.P=this.a=this.L=this.d=q}Va.prototype.clear=function(){this.d=this.P=this.a=q};
Va.prototype.useProgram=function(a,c){if(a!=this.a){this.a=a;this.a.bind();this.a.k.uMvp.data=c.B();var b=this.a.k,d=t(),e;for(e in b)-1!=b[e].id&&(0==b[e].type?d.uniformMatrix4fv(b[e].id,b[e].normalize,b[e].data):1==b[e].type?d.uniformMatrix3fv(b[e].id,b[e].normalize,b[e].data):35665==b[e].type?d.uniform3fv(b[e].id,b[e].data):8==b[e].type?d.uniform1iv(b[e].id,b[e].data):b[e].type==G?d.uniform1f(b[e].id,b[e].data):(3==b[e].type||5124==b[e].type)&&d.uniform1i(b[e].id,b[e].data))}};function Wa(a){this.l=M.A().create(a);this.xa=new Na(this.l);this.m=new Va}function Xa(a,c,b,d){var e=0;for(b=b.w;e<b;++e){var f=a,g=c,p=d[e],m=f,l=g,h=p;if(!(h.N==q||h.d==q)){var j=h.N,v=j.a;v.k.uModel.data=h.Q.B();m.m.useProgram(v,l);l=m.m;h=h.d;h!=l.d&&(l.d=h,l.L=l.d.c,l.d.bind(l.a.f));m.l.drawElements(j.Y,m.m.d.r,m.m.L.j.type,0)}Xa(f,g,p,p.children)}}Wa.prototype.p=function(){return 0};Wa.prototype.q=function(){return 0};window.application=function(){var a=new Wa(document.getElementById("test")),c=new Oa("3D"),b=c.position;b[0]=0;b[1]=0;b[2]=2;c.g=n;Pa(c);b=c.position;b[0]=0;b[1]=0;b[2]=0;c.g=n;var b=new Sa,d=new ia,e=[0.5,-0.5,0,0.5,0.5,0,-0.5,0.5,0,-0.5,-0.5,0];d.D=new Float32Array(e);d.da=e.length;e=[0,1,2,2,3,0];d.r=e.length;d.C=255>d.r?new Uint8Array(e):65535>d.r?new Uint16Array(e):new Uint32Array(e);d.v();var d=new Aa(d,new wa),e=d.Q,f=e.scale;f[0]=1;f[1]=1;f[2]=1;e.g=n;b.add(d);za();a.l.clearColor(0.2,0.2,
0.2,1);a.l.clear(16640);a.l.viewport(c.viewport.x,c.viewport.y,c.viewport.width,c.viewport.height);Xa(a,c,b,b.children);a.m.clear()};
